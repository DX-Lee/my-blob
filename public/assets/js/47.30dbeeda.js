(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{529:function(v,_,t){"use strict";t.r(_);var o=t(4),e=Object(o.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h4",{attrs:{id:"tcp-四次挥手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-四次挥手"}},[v._v("#")]),v._v(" TCP 四次挥手")]),v._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-gold-cdn.xitu.io/2019/6/26/16b911c618264239?imageslim",alt:"img"}}),v._v(" "),t("p",[t("strong",[v._v("第一次挥手")]),v._v("：客户端发送 FIN 报文，之后不再发送数据给服务端")]),v._v(" "),t("p",[t("strong",[v._v("第二次挥手")]),v._v("：服务器收到 FIN 报文后回复 ACK报文")]),v._v(" "),t("p",[t("strong",[v._v("第三次挥手")]),v._v("：服务器也没有数据要发送了，回复 FIN 报文")]),v._v(" "),t("p",[t("strong",[v._v("第四次挥手")]),v._v("：客户端 收到 FIN 报文后 回复 ACK 报文，之后在等待 2 MSL后关闭")]),v._v(" "),t("blockquote",[t("p",[v._v("为什么要 4 次挥手，三次可以吗？")]),v._v(" "),t("p",[v._v("当然可以。由于 "),t("strong",[v._v("延迟确认")]),v._v("的存在，ACK 可以跟随 FIN 包一起捎带回对端。至于 4 次是因为 客户端发送 FIN 报文后，服务器还是可以发送数据的，如果客户端死等服务器发送数据，可能会造成客户端重传 FIN 报文。如果没有数据要传，FIN 和 ACK 当然可以合并一起发回给客户端，4 次挥手也就成了 3 次挥手。")])]),v._v(" "),t("p",[t("strong",[v._v("同时关闭")])]),v._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-gold-cdn.xitu.io/2019/9/28/16d75572508a08d2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}}),v._v(" "),t("p",[v._v("以客户端为例")]),v._v(" "),t("ul",[t("li",[v._v("最初客户端和服务端都处于 ESTABLISHED 状态")]),v._v(" "),t("li",[v._v("客户端发送 "),t("code",[v._v("FIN")]),v._v(" 包，等待对端对这个 FIN 包的 ACK，随后进入 "),t("code",[v._v("FIN-WAIT-1")]),v._v(" 状态")]),v._v(" "),t("li",[v._v("处于"),t("code",[v._v("FIN-WAIT-1")]),v._v("状态的客户端还没有等到 ACK，收到了服务端发过来的 FIN 包")]),v._v(" "),t("li",[v._v("收到 FIN 包以后客户端会发送对这个 FIN 包的的确认 ACK 包，同时自己进入 "),t("code",[v._v("CLOSING")]),v._v(" 状态")]),v._v(" "),t("li",[v._v("继续等自己 FIN 包的 ACK")]),v._v(" "),t("li",[v._v("处于 "),t("code",[v._v("CLOSING")]),v._v(" 状态的客户端终于等到了ACK，随后进入"),t("code",[v._v("TIME-WAIT")])]),v._v(" "),t("li",[v._v("在"),t("code",[v._v("TIME-WAIT")]),v._v("状态持续 2*MSL，进入"),t("code",[v._v("CLOSED")]),v._v("状态")])])])}),[],!1,null,null,null);_.default=e.exports}}]);