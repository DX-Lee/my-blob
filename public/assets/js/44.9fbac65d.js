(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{525:function(t,e,s){"use strict";s.r(e);var _=s(4),i=Object(_.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h4",{attrs:{id:"mtu"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mtu"}},[t._v("#")]),t._v(" MTU")]),t._v(" "),s("p",[t._v("MTU （Maximum Transmission Unit）: 最大传输单元。数据链路层传输的帧大小是有限制的，这个限制就是 MTU。")]),t._v(" "),s("p",[t._v("以太网中的最小帧是64字节，除去头部14字节和4字节的CRC校验字段，有效的载荷是46字节，最大帧大小是1518字节，有效载荷的最大值就是1500字节。如果需要传输100KB的数据，则至少需要 （100 * 1024 / 1500）= 69 个以太网帧。（注意：不同的数据链路层的 MTU 是不同的）")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/3/1700a73e260cd0cd?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}}),t._v(" "),s("p",[s("strong",[t._v("IP分段")])]),t._v(" "),s("p",[t._v("IPV4数据报的帧最大可以达到65535字节，远远大于 以太网的 MTU，因此 当一个 IP 包 大小 大于 MTU")]),t._v(" "),s("p",[t._v("时，会将原来的包拆分成一个个小的片段（小于 MTU），使得这些小的报文可以在数据链路中传输。")]),t._v(" "),s("p",[t._v("IP 头部字段有一个表示分片偏移量的字段，用来表示该分段在原始数据中的位置。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/3/1700a73e185162dc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"img"}})]),t._v(" "),s("p",[t._v("由于 IP 层不会对丢包进行重发，如果 IP 分段中有丢失，损坏的情况下，目标主机没办法将分段的数据包重组成完整的数据包，需要依赖传输层进行重传。")]),t._v(" "),s("p",[s("strong",[t._v("路径MTU")])]),t._v(" "),s("p",[t._v("一个包从发送端到接收端需要经过跨越多个网络，每个链路的 MTU 可能不一样，通信过程中遇到的最小 MTU 称为 路径 MTU。比如 第一段链路 MTU 大小为 1500 字节，第二段链路 MTU 为 800 字节，第三段链路 MTU 为 1200 字节，则路径 MTU 为三段 MTU 的最小值 800。")]),t._v(" "),s("p",[t._v("当 数据包在 IP 层设置了不分段，而数据包过大（大于 MTU）时会收到 ICMP 告知报文过大的错误 。TCP 为了避免底层分片，立即拆包，重新计算包的大小。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/3/1700a73e887eea11?imageslim",alt:"img"}}),t._v(" "),s("p",[t._v("由于 MTU 的存在 ，TCP 发送的数据包大小也限制了，这个限制就是 MSS 。")]),t._v(" "),s("p",[s("strong",[t._v("MSS （Max Segment Size）TCP最大段大小")])]),t._v(" "),s("p",[t._v("TCP 为了避免被发送方分段，主动将数据分为小段在交给网络层，这个最大的分段大小就是 MSS。")]),t._v(" "),s("blockquote",[s("p",[t._v("MSS = MTU - IP 头部大小 - TCP 头部大小")])]),t._v(" "),s("p",[t._v("这样一个 MSS 数据可以刚好装进一个 MTU 而不用分片")]),t._v(" "),s("p",[t._v("以太网中 TCP 的MSS 最大 = 1500 - 20 （IP 头部大小）- 20 （TCP头部大小）= 1460")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/3/1700a73e8c79596f?imageslim",alt:"img"}}),t._v(" "),s("p",[t._v("当三次握手时，通信双方会在 SYN 报文中 说明自己允许的 最大段大小。")]),t._v(" "),s("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://user-gold-cdn.xitu.io/2020/2/3/1700a73e8a06ec69?imageslim",alt:"img"}}),t._v(" "),s("p",[t._v("图中 MSS = 1500 - 20（IP固定头部大小） - 20（TCP固定 头部大小） - 12 （TCP 可选项大小）= 1448")]),t._v(" "),s("p",[t._v("TCP socket 套接字选项 TCP_MAXSEG 可以设置本次连接的 MSS 大小，范围在 88~32768。下限 88 是为了保证TCP 头部大小和 IP 头部大小 占满 60 个字节的情况下，至少还能在发送 8 字节的数据。所以 为 40 + 40 + 8 = 88")]),t._v(" "),s("p",[s("strong",[t._v("总结")])]),t._v(" "),s("p",[t._v("MTU 为数据链路层中能通过的最大数据包大小。IP 数据包长度大于 MTU 时需要分片，TCP 为了避免分片会主动将包分割成 MSS 大小。")])])}),[],!1,null,null,null);e.default=i.exports}}]);