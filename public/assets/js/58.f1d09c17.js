(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{549:function(e,s,n){"use strict";n.r(s);var t=n(4),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[e._v("如果一端因为网络故障或者系统宕机，如果应用程序不发送数据，对端可能永远也不知道连接已经失效。因为 TCP 并不是一个轮询的协议。")]),e._v(" "),n("p",[e._v("keep-alive就是用来检测长时间连接是否失效。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// 30s没有数据包交互发送 keepalive 探测包\necho 30 > /proc/sys/net/ipv4/tcp_keepalive_time\n// 每次探测TCP 包间隔\necho 10 > /proc/sys/net/ipv4/tcp_keepalive_intvl\n// 探测多少次\necho 5 > /proc/sys/net/ipv4/tcp_keepalive_probes\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("keepalive 探测包 7200s后检测一次，探测 9 次，每次探测间隔 75s，这些值都有对应的参数可以配置。")]),e._v(" "),n("p",[n("strong",[e._v("为什么大部分应用程序都没有开启 keep-alive选项")])]),e._v(" "),n("p",[e._v("因为默认探测时长太长了，从没有数据交互到确认连接失效需要花费  2.1875小时（7200 + 75*9）。如果设置的过小，又违背了keep-alive的初衷，检测长时间死连接。")]),e._v(" "),n("p",[e._v("因此一般在应用层做连接的有效检测，也就是我们常说的心跳包。")])])}),[],!1,null,null,null);s.default=a.exports}}]);